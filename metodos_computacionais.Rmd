---
title: Comparação do estimador de máxima verossimilhança e estimador de máxima verossimilhança corrigido por bootstrap na Distribuição Gompertz

# use letras para afiliacao
author:
  - name: Ivonaldo Silvestre
    affiliation: a,b
  - name: Fabrício Emiliano
    affiliation: a,b
  - name: Alessandro Pereira
    affiliation: a,b
  - name: Leonardo Barros
    affiliation: a,b  
address:
  - code: a
    address: Departamento de Estatística - UFRN
  - code: b
    address: Aluno

# area do conhecimento (pelo menos uma)
subject:
  - "Métodos Computacionais em Estatística"

# palavras-chave
keywords:
  - Distribuição Gompertz
  - máxima verossimilhança
  - bootstrap

# resumo - note a barra vertical e os dois espaços no início do parágrafo
abstract: |
  O objetivo desse trabalho é avaliar, em termos de viés e erro quadrático médio, o estimador de máxima verossimilhança e o estimador de máxima verossimilhança corrigido por bootstrap, dos parâmetros a e b da Distribuição Gompertz. 

# arquivo com a bibliografia do relatorio
bibliography: modeloLEA.bib

header-includes:
   - \usepackage{bm}
   
output: 
  bookdown::pdf_book:
    base_format: modeloLEA::modeloLEA
---


```{r definicoes, include=FALSE, message=FALSE}
# pacotes a serem carregados para a analise
require(flexsurv)
# definicoes globais 
# tamanho das figuras: largura=5, altura=4 (polegadas)
knitr::opts_chunk$set(fig.width=5, fig.height=4, 
# exibir o codigo do R nos chunks (mudar para FALSE na versao final)
                      echo=F,
# mandar o latex manter a figura na posicao correta
                      fig.pos='h')
```



# Introdução

Benjamin Gompertz foi um matemático judeu, que comprovou que a taxa de mortalidade cresce geometricamente e em 1825, no estudo __*On the Nature of the Function Expressive of the Law of Human Mortality, and on a New Mode of Determining the Value of Life Contingencies*__, ele apresentou uma lei que descrevia o crescimento geométrico da taxa de mortalidade e "é um dos modelos matemáticos clássicos que representam a função de sobrevivência com base nas leis da mortalidade. Essa distribuição desempenha um papel importante na modelagem da mortalidade humana e no ajuste das tabelas atuariais." (A. El-Gohary et al., 2013, p.2, tradução nossa). Além disso, a distribuição Gompertz pode ser aplicada em diversas areas de conhecimento, como "(Gottwald et al. (1998) aplicaram o modelo de Gompertz para avaliar a ocorrência do vírus causador da "tristeza dos citros" na Costa Rica e República Dominicana. Marin et al. (1998) usaram essa função para modelar o crescimento dos fungos Aspergillus e Penicillium em milho." (Guimarães, 2002, p.12). 

# Metodologia

A sua função de densidade de probabilidade é dada por

$$ f(x;a,b) = be^{ax}exp[-b/a(e^{ax}-1)],\ x>0, $$
em que $a > 0$ representa o parâmetro de forma e $b>0$ representa o parâmetro de escala. Sua distribuição acumulada é dada por

$$ F(x;a,b) = 1 - exp[-b/a(e^{ax}-1)],\ x>0.$$
Ao selecionar uma amostra aleatória de tamanho $n,$ podemos encontrar a função de verossimilhança é dada pela forma

$$L(a,b;\bm{x}) = b^nexp\left(a\sum_{i=1}^nx_i\right) exp\left[-\frac{b}{a}\left(\sum_{i=1}^ne^{ax_i}-n\right)\right],$$
logo, a função log-verossimilhança é da forma

$$ l(a,b;\bm{x}) = n\ log (b) + a\sum_{i=1}^nx_i - \frac{b}{a}\left(\sum_{i=1}^ne^{ax_i}-n\right).$$
O vetor escore $\bm{U}(a,b;\bm{x}) = (U_a(a,b;\bm{x}),\ U(a,b;\bm{x}))^\top$ são dadas respectivamente por

\begin{align*}
U_a(a,b;\bm{x}) &= \sum_{i=1}^nx_i + \frac{b}{a^2}\left(\sum_{i=1}^n \left[e^{ax_i}(1-ax_i)\right]-n \right)
\\
U_b(a,b;\bm{x}) &= \frac{n}{b}-\frac{1}{a}\left(\sum_{i=1}^ne^{ax_i}-n\right).
\end{align*}
A solução dada por $\hat a$ e $\hat b$ quando $\bm{U}(a,b;\bm{x}) = 0$ não pode ser resolvida analiticamente, sendo necessários métodos computacionais para a resolução simultânea do vetor. A matriz de informação de Fisher com os dados observados é uma matriz simétrica $2\times 2,$ da forma
$$I_0(\hat a,\hat b) = \left[
\begin{array}{cc}
A & B  \\
B & C
\end{array}
\right],
$$

sendo

\begin{align*}
A & = \frac{\hat b}{\hat a^3} \left\{2\sum_{i=1}^n \left[e^{\hat a x_i}(1-\hat a x_i)-1\right] -\hat a \sum_{i=1}^n \left[e^{\hat a x_i}x_i[(1-\hat a x_i)^2-1]\right]  \right\}\\
B & = - \frac{1}{\hat a^2} \sum_{i=1}^n \left[e^{\hat a x_i} (1-\hat a x_i)-1 \right]\\
C & = \frac{n}{\hat b^2}.
\end{align*}

Logo, a inversa da matriz de informação de Fisher é 

$$I_0^{-1}=\frac{1}{AC-B^2}\left[
\begin{array}{cc}
C & -B  \\
-B & A
\end{array}
\right].$$

Assintoticamente, o vetor $(\hat a, \hat b)^\top$ segue uma distribuição normal de parâmetros

$$\left(\begin{array}{c}
\hat a \\
\hat b
\end{array}\right) \sim N\left( \left(\begin{array}{c}
a \\
b
\end{array}\right), I_0^{-1} \right).$$

Portanto, para construir um intervalo com $100(1-\alpha)\%$ de confiança para $a$ e $b,$ usa-se as seguintes fórmulas

\begin{align*}
IC[a;100(1-\alpha)\%] &= \left[\hat a - Z_{\alpha/2}\sqrt{\frac{C}{AC-B^2}};\hat a + Z_{1-\alpha/2}\sqrt{\frac{C}{AC-B^2}} \right]\\
IC[b;100(1-\alpha)\%] &= \left[\hat b - Z_{\alpha/2}\sqrt{\frac{A}{AC-B^2}};\hat b + Z_{1-\alpha/2}\sqrt{\frac{A}{AC-B^2}} \right],
\end{align*}

em que $Z_q$ representa o quantil da distribuição normal padrão com probabilidade acumulada $q$.
Falar sobre monte carlo e bootstrap.



A estimação dos parâmetros é um dos pontos fundamentais para o ajuste de um modelo. E neste trabalho vamos mostrar dois métodos diferentes de estimação dos parâmetros, o método do estimador de máxima verossimilhança e o estimador por monte carlo corrigido por bootstrap. É importante ressaltar que vamos estimar dois pares de valores diferentes dos parâmetros a e b, primeiramente vamos estimar $a=2$ e $b=3$, e também vamos estimar $a=0.5$ e $b=0.5$. Assim como iremos avaliar os estimadores para diferentes números de amostras, neste trabalho serão utilizados $n = 25,\ 50,\ 100$ e $200$.) Utilizando os chutes iniciais para a e b, podemos obter as estimativas pontuais para os parâmetros pelo método de máxima verossimilhança.


# Resultados

  Primeiramente, vamos usar o Método da Transformação inversa para gerar números pseudos-aleatórios que seguem a distribuição Gompertz. A Figura \ref{fig:comp} Comparando os n números pseudos-aleatórios gerados, usando o métodos da transformada inversa e n números gerados obtidos a partir da função de densidade de probabilidade da distribuição Gompertz a partir do pacote *flexsurv*.
  

```{r geração}

rgomp=function(n,a,b){
  u=runif(n)
  log(1 -a/b*log(1-u))/a #Inversa da função de distribuição acumulada
}

pfun1 <- function(x,a,b){
  f <- (b*(exp(1)^(a*x)))*exp((-b/a)*((exp(1)^(a*x))-1)) #Densidade
  return(f)
}



n=5000
a=1
b=1
dados=rgomp(n,a,b)
dados2=rgompertz(n,a,b)
x <- seq(0, max(dados), 0.01)

```
```{r comparacao,figures-side, fig.show="hold", out.width="50%",fig.caption="\\label{fig:comp}Comparação entre os números pseudo aleatórios gerados"}  

#Histograma dos dados gerados.
hist(dados2,freq = FALSE,main="",xlab="x",ylab="Density-fun",lwd=2)
lines(x,pfun1(x,a,b),lty=1,lwd=2)
box()

#Histograma dos dados obtidos pela função densidade.
hist(dados,freq = FALSE,main="",xlab="x",ylab="Density-uni",lwd=2)
lines(x,pfun1(x,a,b),lty=1,lwd=2)
box()
```
```{r chute}

#Log da função de verossimilhança
logdgomp=function(x,dados){
  a=x[1]
  b=x[2]
  -sum(log(b)+a*dados-b/a*(exp(a*dados)-1))
}


achute=1 #Chute inicial para o parâmetro a
bchute=1 #Chute inicial para o parâmetro b
(chute=c(achute,bchute))
```


## Estimação dos parâmetros


tabelas
```{r tabelas}
tabela25=read.csv2("Tabela25.csv")
tabela50=read.csv2("Tabela50.csv")
tabela100=read.csv2("Tabela100.csv")
tabela200=read.csv2("Tabela200.csv")
a2b3=rbind(tabela25[1:4,],tabela50[1:4,],tabela100[1:4,],tabela200[1:4,])
a2b3=a2b3[order(a2b3$`Parâmetro`),]
a2b3=a2b3[,c(1,5:8)]
a2b3=cbind(a2b3[1:8,],a2b3[9:16,])
a2b3=a2b3[,-6]
a2b3
a5b5=rbind(tabela25[-c(1:4),],tabela50[-c(1:4),],
           tabela100[-c(1:4),],tabela200[-c(1:4),])
a5b5=a5b5[order(a5b5$`Parâmetro`),]
a5b5=a5b5[,c(1,5:8)]
a5b5=cbind(a5b5[1:8,],a5b5[9:16,])
a5b5=a5b5[,-6]
a5b5
library(xtable)
xtable(a5b5,digits=4)
```

Comentar as tabelas
  
```{r estimativas}
#Estimador de máxima verossimilhança 
estimativas=optim(par=chute,fn=logdgomp,dados=dados)$par
(ahat=estimativas[1]) #Estimador pontual para a
(bhat=estimativas[2]) #Estimador pontual para b
```
```{r IC}
C=n/bhat^2
B=-sum(exp(ahat*dados)*(1-ahat*dados)-1)/ahat^2
A=bhat/ahat^3*(2*(sum(exp(ahat*dados)*(1-ahat*dados))-1) -
           ahat*sum(exp(ahat*dados)*dados*((1-ahat*dados)^2-1))
         )
varahat=C/(A*C-B^2)
varbhat=A/(A*C-B^2)
covabhat=-B/(A*C-B^2)
(ICa=ahat+c(-1,1)*1.96*sqrt(varahat))#Intervalo de confiança para a
(ICb=bhat+c(-1,1)*1.96*sqrt(varbhat))#Intervalo de confiança para b
```
```{r var}
varahat=C/(A*C-B^2)
varbhat=A/(A*C-B^2)
covabhat=-B/(A*C-B^2)
(ICa=ahat+c(-1,1)*1.96*sqrt(varahat))#Intervalo de confiança para a
(ICb=bhat+c(-1,1)*1.96*sqrt(varbhat))
```
```{r informacoes}
# usando n = 25, 50, 100 e 200
# R=5000
# B=500
# 2 configuracoes de parametros
```
# Conclusão


# Referências

A. El-Gohary et al., Applied Mathematical Modelling. 37. ed. Saudi Arabia: Elsevier, 2013.

Guimarães, Uma Função Hiperbólica de Distribuição Probabilística de Alta Flexibilidade. 1. ed. Planaltina: Embrapa, 2002.

# Códigos utilizados
